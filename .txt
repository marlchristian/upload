<!DOCTYPE html>
<html>
<head>
    <title>QR Form Scanner</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
    <h2>QR Form Scanner</h2>

    <label>Name: <input type="text" id="userName"></label><br><br>

    <div id="stepDisplay">Step: Scan Location</div>
    <div id="qr-reader" style="width: 300px;"></div>

    <button onclick="submitData()" style="display:none;" id="submitBtn">Submit</button>

    <script>
        let step = 0;
        const data = {
            name: '',
            location: '',
            area: '',
            bay: null,
            station: null
        };

        const stepDisplay = document.getElementById('stepDisplay');
        const submitBtn = document.getElementById('submitBtn');

        const steps = [
            { key: 'location', text: 'Scan Location' },
            { key: 'area', text: 'Scan Area' },
            { key: 'bay', text: 'Scan Bay (Optional)' },
            { key: 'station', text: 'Scan Station (Optional if Bay scanned)' }
        ];

        function onScanSuccess(decodedText) {
            const key = steps[step].key;
            data[key] = decodedText;
            console.log(`Step ${step + 1}: ${key} = ${decodedText}`);

            if (key === 'bay' && !decodedText) {
                data.station = null;
                step += 2;
                finish();
                return;
            }

            if (key === 'station' || step >= steps.length - 1) {
                finish();
                return;
            }

            step++;
            stepDisplay.innerText = `Step: ${steps[step].text}`;

            html5QrCode.stop().then(() => startScanner());
        }

        function startScanner() {
            html5QrCode.start(
                { facingMode: "environment" },
                { fps: 10, qrbox: { width: 250, height: 250 } },
                onScanSuccess
            );
        }

        function finish() {
            stepDisplay.innerText = 'Done! Click Submit';
            submitBtn.style.display = 'inline-block';
        }

        function submitData() {
            data.name = document.getElementById('userName').value;

            fetch('/api/qrform', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(res => {
                if (res.ok) {
                    alert('Data saved!');
                    location.reload();
                } else {
                    alert('Failed to save data.');
                }
            });
        }

        const html5QrCode = new Html5Qrcode("qr-reader");
        startScanner();
    </script>
</body>
</html>

Method 'Identifier' in type 'Microsoft.EntityFrameworkCore.Design.Internal.CSharpHelper' from assembly 'Microsoft.EntityFrameworkCore.Design, Version=8.0.11.0, Culture=neutral, PublicKeyToken=adb9793829ddae60' does not have an implementation.

@model QrFormApp.Models.QrForm

@{
    ViewData["Title"] = "Create";
}

<h1>Create</h1>

<h4>QR Form</h4>
<hr />
<div class="row">
    <div class="col-md-6">
        <form asp-action="Create">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <div class="form-group">
                <label asp-for="Name" class="control-label"></label>
                <input asp-for="Name" class="form-control" />
                <span asp-validation-for="Name" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="Location" class="control-label"></label>
                <input asp-for="Location" class="form-control" />
                <span asp-validation-for="Location" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="Area" class="control-label"></label>
                <input asp-for="Area" class="form-control" />
                <span asp-validation-for="Area" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="Bay" class="control-label"></label>
                <input asp-for="Bay" class="form-control" />
                <span asp-validation-for="Bay" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="Station" class="control-label"></label>
                <input asp-for="Station" class="form-control" />
                <span asp-validation-for="Station" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="Assets" class="control-label"></label>
                <input asp-for="Assets" class="form-control" />
                <span asp-validation-for="Assets" class="text-danger"></span>
            </div>

            <div class="form-group mt-3">
                <input type="submit" value="Submit" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div class="mt-2">
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}